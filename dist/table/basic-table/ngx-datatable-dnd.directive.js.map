{"version":3,"sources":["../../../build/src/app/table/basic-table/ngx-datatable-dnd.directive.ts"],"names":[],"mappings":"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","file":"ngx-datatable-dnd.directive.js","sourceRoot":"","sourcesContent":["import {\r\n  AfterViewInit,\r\n  Directive,\r\n  ElementRef,\r\n  EventEmitter,\r\n  Input,\r\n  OnChanges,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output,\r\n  SimpleChange\r\n} from '@angular/core';\r\n\r\nimport { dragula, DragulaService } from 'ng2-dragula';\r\n\r\n/**\r\n * Drag and drop directive used with the underlying ngx-datatable component.\r\n *\r\n * Note: When drag and drop is avaiable upstream, this functionlity will likely be removed\r\n *\r\n * See: https://github.com/swimlane/ngx-datatable/issues/411\r\n */\r\n\r\nexport class NgxDataTableDndDirective implements AfterViewInit, OnChanges, OnDestroy, OnInit {\r\n   public dragulaName: string;\r\n   public dragulaModel: any;\r\n   public dragulaClassSelector: string = 'null';\r\n   public dragulaDrop: EventEmitter<any> = new EventEmitter<any>();\r\n   public dragulaDrag: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  subscriptionDrag: any = null;\r\n  subscriptionDrop: any = null;\r\n\r\n  protected container: any;\r\n  private drake: any;\r\n  private el: ElementRef;\r\n  private dragulaService: DragulaService;\r\n\r\n  public constructor(el: ElementRef, dragulaService: DragulaService) {\r\n    this.el = el;\r\n    this.dragulaService = dragulaService;\r\n  }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    if (this.el) {\r\n      let container = this.el;\r\n\r\n      // Check for the row's parent node: datatable-scroller\r\n      // This is what you want to bind Dragula to, in order to drag sort\r\n      if (container.nativeElement.querySelector('datatable-scroller')) {\r\n        let rowParent =  container.nativeElement.querySelector('datatable-scroller');\r\n\r\n        // Check if this Dragula already exists\r\n        if (!this.dragulaService.find(this.dragulaName)) {\r\n\r\n          // Must assign the new rowParent as the container you want to pass to Dragula\r\n          this.container = rowParent;\r\n          this.initializeDragula();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  ngOnChanges(changes: { dragulaModel?: SimpleChange }): void {\r\n\r\n    // Must update model on any changes\r\n    // Otherwise it will fall out of sync with the 'dragulaModel'\r\n    if (changes && changes.dragulaModel) {\r\n      if (this.drake) {\r\n        if (this.drake.models) {\r\n          let modelIndex = this.drake.models.indexOf(changes.dragulaModel.previousValue);\r\n          this.drake.models.splice(modelIndex, 1, changes.dragulaModel.currentValue);\r\n        } else {\r\n          this.drake.models = [changes.dragulaModel.currentValue];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n\r\n    // Clear this Dragula always\r\n    // comment out if you want to keep it\r\n    if (this.dragulaService.find(this.dragulaName)) {\r\n      this.dragulaService.destroy(this.dragulaName);\r\n    }\r\n\r\n    // Clear DRAG and DROP subscription to prevent duplicates\r\n    if (this.subscriptionDrag) {\r\n      this.subscriptionDrag.unsubscribe();\r\n      this.subscriptionDrag = null;\r\n    }\r\n    if (this.subscriptionDrop) {\r\n      this.subscriptionDrop.unsubscribe();\r\n      this.subscriptionDrop = null;\r\n    }\r\n  }\r\n\r\n  protected initializeDragula() {\r\n    // console.log('initialized');\r\n    // Create new Dragula container\r\n    let bag = this.dragulaService.find(this.dragulaName);\r\n    if (bag) {\r\n      this.drake = bag.drake;\r\n      this.checkModel();\r\n      this.drake.containers.push(this.container);\r\n    } else {\r\n\r\n      // Check if dragulaClassSelector was specified\r\n      // *true:\r\n      //    - the dragulaClassSelector string will be used to match the class of the element clicked\r\n      //    - the element with the matching class name will be used to drag the row\r\n      // *false:\r\n      //    - no class selector will be used\r\n      //    - the whole row will default back to being draggable\r\n      if (this.dragulaClassSelector !== 'null') {\r\n        let classSelector = this.dragulaClassSelector;\r\n        let options = {\r\n          moves: function(el: any, container: any, handle: any) {\r\n            return handle.className === classSelector;\r\n          }\r\n        };\r\n        this.drake = dragula([this.container], options);\r\n      } else {\r\n        this.drake = dragula([this.container]);\r\n      }\r\n      this.checkModel();\r\n      this.dragulaService.add(this.dragulaName, this.drake);\r\n    }\r\n\r\n    // Set DRAG and DROP subscriptions and callbacks\r\n    this.subscriptionDrag = this.dragulaService.drag.subscribe((value: any) => {\r\n      this.drag(value.slice(1));\r\n    });\r\n    this.subscriptionDrop = this.dragulaService.drop.subscribe((value: any) => {\r\n      const [bagName, el, target, source] = value;\r\n\r\n      this.onDropModel(value.slice(1));\r\n    });\r\n  }\r\n\r\n  private checkModel() {\r\n    if (this.dragulaModel) {\r\n      if (this.drake.models) {\r\n        this.drake.models.push(this.dragulaModel);\r\n      } else {\r\n        this.drake.models = [this.dragulaModel];\r\n      }\r\n    }\r\n  }\r\n\r\n  private drag(args: any) {\r\n    let [e, el] = args;\r\n    // Todo: not implemented\r\n  }\r\n\r\n  private onDropModel(args: any) {\r\n    let [el, target, source] = args;\r\n\r\n    // Added emitter on any DROP action\r\n    // console.log('EMITTER', args);\r\n    this.dragulaDrop.emit(this.dragulaModel);\r\n  }\r\nstatic decorators: DecoratorInvocation[] = [\n{ type: Directive, args: [{\r\n  selector: 'ngx-datatable[dragulaName]'\r\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ElementRef, },\n{type: DragulaService, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'dragulaName': [{ type: Input },],\n'dragulaModel': [{ type: Input },],\n'dragulaClassSelector': [{ type: Input },],\n'dragulaDrop': [{ type: Output },],\n'dragulaDrag': [{ type: Output },],\n};\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}